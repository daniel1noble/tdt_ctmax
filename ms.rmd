---
title: ""
author: et al. 
date: "`r Sys.Date()`"
bibliography: ./bib/refs.bib
csl: ./bib/ecology-letters.csl
output: 
  bookdown::word_document2:
    toc: no
    toc_depth: 6
    number_sections: false
    reference_docx: ./bib/template.docx
  bookdown::html_document2:
    code_folding: hide
    number_sections: no
    toc: yes
    toc_depth: 6
    toc_float: yes
    bibliography: refs.bib
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, tidy = TRUE, fig.width = 10)
## numbers >= 10^5 will be denoted in scientific notation,		  ## numbers >= 10^5 will be denoted in scientific notation,
  ## and rounded to 2 digits		  ## and rounded to 2 digits
  options(digits = 2)

##################################
# Clean workspace
##################################
    rm(list=ls())

##################################
# Loading packages & Functions
##################################
    pacman::p_load(tidyverse,  metafor, flextable,  patchwork, ggtree, ape, phytools, viridis, MCMCglmm, brms, latex2exp, orchaRd, multcomp)


```


```{r, tree}
# Bring in the fly tree
tree <- read.tree("./phylogeny/drosi.tre")

# Plot the tree
plot(tree, cex = 0.2)

# Ultrametric?
is.ultrametric(tree) # nope

# Grab phylo matrix
phy_vcv <- vcv(tree)

```


```{r}
## Models
   ctmax <- mv(ctmax | se(sqrt(ctmax_se)) ~ 1 + (1|q|gr(phylo = phy_vcv)) + (1|spp) + (1|obs)) + gaussian()
    cfts <- mv( cfts | se(sqrt(cfts_se))  ~ 1 + (1|q|gr(phylo = phy_vcv)) + (1|spp)) + gaussian()
   tdt_i <- mv(tdt_i |  mi() ~ 1 + (1|q|gr(phylo = phy_vcv)) + (1|spp)) + gaussian()
   tdt_z <- mv(tdt_z |  mi() ~ 1 + (1|q|gr(phylo = phy_vcv)) + (1|spp)) + gaussian()

                    
       mv_brms_model <- brms::brm(ctmax + tdt_i + tdt_z + cfts, 
                        warmup = 1000, iter = 4000, thin = 5, 
                        control = list(adapt_delta = 0.95, max_treedepth = 15), 
                        data = data, data2 = phy_vcv)

```


## References
